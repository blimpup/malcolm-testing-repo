dirs:
  modules/**:
    when_modified:
      file_patterns: []
  # protected workspaces
  environments/production/sso/**:
    when_modified:
      file_patterns: []
  environments/production/iam/**:
    when_modified:
      file_patterns: []
  environments/staging/iam/**:
    when_modified:
      file_patterns: []
  environments/staging/**:
    tags: [staging]
  environments/production/**:
    tags: [production]
workflows:
  - tag_query: staging
    plan:
      - type: env
        name: "RUN_ENV"
        cmd: ["echo", "STAGING"]
      - type: run
        cmd: ["${TERRATEAM_ROOT}/expect-env", "STAGING"]
      - type: init
      - type: plan
    apply:
      - type: env
        name: "RUN_ENV"
        cmd: ["echo", "STAGING"]
      - type: run
        cmd: ["${TERRATEAM_ROOT}/expect-env", "STAGING"]
      - type: init
      - type: apply
  - tag_query: production
    plan:
      - type: env
        name: "RUN_ENV"
        cmd: ["echo", "PROD"]
      - type: run
        cmd: ["${TERRATEAM_ROOT}/expect-env", "PROD"]
      - type: init
      - type: plan
    apply:
      - type: env
        name: "RUN_ENV"
        cmd: ["echo", "PROD"]
      - type: run
        cmd: ["${TERRATEAM_ROOT}/expect-env", "PROD"]
      - type: init
      - type: apply
